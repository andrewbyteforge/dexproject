{% extends 'base.html' %}
{% load static %}

{% block title %}Fast Lane Configuration - DEX Trading Bot{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dashboard/css/fast_lane_config.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid" data-trading-enabled="true">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'dashboard:home' %}">Dashboard</a></li>
                            <li class="breadcrumb-item"><a href="{% url 'dashboard:mode_selection' %}">Mode Selection</a></li>
                            <li class="breadcrumb-item active">Fast Lane Configuration</li>
                        </ol>
                    </nav>
                    <h1 class="h2 mb-1">
                        <i class="bi bi-lightning-charge fast-lane-accent me-2"></i>
                        <span class="fast-lane-accent">Fast Lane Configuration</span>
                    </h1>
                    <p class="text-muted mb-0">High-speed trading configuration with real-time execution</p>
                </div>
                <div>
                    <button class="btn btn-outline-secondary me-2" onclick="resetConfiguration()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Reset
                    </button>
                    <a href="{% url 'dashboard:mode_selection' %}" class="btn btn-outline-light">
                        <i class="bi bi-arrow-left me-1"></i>Back
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Configuration Panel -->
        <div class="col-xl-8">
            <div class="card fast-lane-container mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-gear me-2"></i>Performance Configuration
                    </h5>
                </div>
                <div class="card-body">
                    <form id="fast-lane-config-form">
                        <!-- Execution Speed Settings -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="execution_timeout" class="form-label">
                                    Execution Timeout
                                    <i class="bi bi-info-circle ms-1" data-bs-toggle="tooltip" 
                                       title="Maximum time to wait for trade execution"></i>
                                </label>
                                <div class="input-group">
                                    <input type="range" class="form-range" id="execution_timeout" 
                                           min="100" max="2000" step="100" value="500">
                                    <span class="input-group-text" id="timeout-display">500ms</span>
                                </div>
                                <small class="text-muted">Trade execution timeout (100ms - 2000ms)</small>
                            </div>
                            <div class="col-md-6">
                                <label for="max_slippage" class="form-label">
                                    Maximum Slippage
                                    <i class="bi bi-info-circle ms-1" data-bs-toggle="tooltip" 
                                       title="Maximum acceptable price slippage"></i>
                                </label>
                                <div class="input-group">
                                    <input type="range" class="form-range" id="max_slippage" 
                                           min="0.1" max="5.0" step="0.1" value="1.0">
                                    <span class="input-group-text" id="slippage-display">1.0%</span>
                                </div>
                                <small class="text-muted">Maximum slippage tolerance (0.1% - 5.0%)</small>
                            </div>
                        </div>

                        <!-- Position Sizing -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="default_position_size" class="form-label">
                                    Default Position Size (ETH)
                                </label>
                                <input type="number" class="form-control" id="default_position_size" 
                                       min="0.001" max="10" step="0.001" value="0.1">
                                <small class="text-muted">Default amount per trade (0.001 - 10 ETH)</small>
                            </div>
                            <div class="col-md-6">
                                <label for="max_position_size" class="form-label">
                                    Maximum Position Size (ETH)
                                </label>
                                <input type="number" class="form-control" id="max_position_size" 
                                       min="0.001" max="100" step="0.001" value="1.0">
                                <small class="text-muted">Maximum amount per trade (0.001 - 100 ETH)</small>
                            </div>
                        </div>

                        <!-- Gas Configuration -->
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <label for="gas_price_multiplier" class="form-label">
                                    Gas Price Multiplier
                                </label>
                                <select class="form-select" id="gas_price_multiplier">
                                    <option value="1.0">Standard (1.0x)</option>
                                    <option value="1.2" selected>Fast (1.2x)</option>
                                    <option value="1.5">Faster (1.5x)</option>
                                    <option value="2.0">Fastest (2.0x)</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="max_gas_price" class="form-label">
                                    Max Gas Price (Gwei)
                                </label>
                                <input type="number" class="form-control" id="max_gas_price" 
                                       min="10" max="1000" step="1" value="100">
                            </div>
                            <div class="col-md-4">
                                <label for="priority_fee" class="form-label">
                                    Priority Fee (Gwei)
                                </label>
                                <input type="number" class="form-control" id="priority_fee" 
                                       min="1" max="50" step="0.1" value="2.0">
                            </div>
                        </div>

                        <!-- MEV Protection -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <label class="form-label">MEV Protection Settings</label>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_mev_protection" checked>
                                            <label class="form-check-label" for="enable_mev_protection">
                                                Enable MEV Protection
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="use_private_mempool" checked>
                                            <label class="form-check-label" for="use_private_mempool">
                                                Use Private Mempool
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_sandwich_protection" checked>
                                            <label class="form-check-label" for="enable_sandwich_protection">
                                                Sandwich Protection
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Trading Pairs Selection -->
                        <div class="mb-4">
                            <label class="form-label">Target Trading Pairs</label>
                            <div class="row g-2" id="trading-pairs-container">
                                <div class="col-md-6">
                                    <div class="trading-pair-card selected" data-pair="WETH/USDC">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>WETH/USDC</strong>
                                                <br><small class="text-muted">Most liquid pair</small>
                                            </div>
                                            <div class="text-end">
                                                <div class="text-success">$2.4B</div>
                                                <small class="text-muted">Liquidity</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="trading-pair-card" data-pair="WETH/USDT">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>WETH/USDT</strong>
                                                <br><small class="text-muted">High volume</small>
                                            </div>
                                            <div class="text-end">
                                                <div class="text-info">$1.8B</div>
                                                <small class="text-muted">Liquidity</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="trading-pair-card" data-pair="WETH/DAI">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>WETH/DAI</strong>
                                                <br><small class="text-muted">Stable pair</small>
                                            </div>
                                            <div class="text-end">
                                                <div class="text-warning">$890M</div>
                                                <small class="text-muted">Liquidity</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="trading-pair-card" data-pair="WBTC/WETH">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>WBTC/WETH</strong>
                                                <br><small class="text-muted">BTC exposure</small>
                                            </div>
                                            <div class="text-end">
                                                <div class="text-primary">$456M</div>
                                                <small class="text-muted">Liquidity</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Risk Management -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="stop_loss_percent" class="form-label">
                                    Stop Loss (%)
                                </label>
                                <input type="number" class="form-control" id="stop_loss_percent" 
                                       min="1" max="50" step="0.5" value="10" placeholder="Optional">
                                <small class="text-muted">Automatic stop loss percentage (optional)</small>
                            </div>
                            <div class="col-md-6">
                                <label for="take_profit_percent" class="form-label">
                                    Take Profit (%)
                                </label>
                                <input type="number" class="form-control" id="take_profit_percent" 
                                       min="1" max="1000" step="0.5" value="25" placeholder="Optional">
                                <small class="text-muted">Automatic take profit percentage (optional)</small>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-secondary" onclick="resetConfiguration()">
                                <i class="bi bi-arrow-clockwise me-1"></i>Reset to Defaults
                            </button>
                            <div>
                                <button type="button" class="btn btn-outline-success me-2" onclick="testConfiguration()">
                                    <i class="bi bi-play-circle me-1"></i>Test Configuration
                                </button>
                                <button type="submit" class="fast-execute-btn">
                                    <i class="bi bi-lightning-charge me-1"></i>Save & Activate
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Live Trading Controls -->
            <div class="trading-controls" id="trading-controls" style="display: none;">
                <h5 class="mb-3">
                    <i class="bi bi-lightning-charge me-2"></i>Live Fast Lane Trading
                </h5>
                
                <div class="row g-3">
                    <!-- Quick Buy Panel -->
                    <div class="col-md-6">
                        <div class="quick-buy-panel">
                            <h6 class="mb-3">
                                <i class="bi bi-cart-plus me-2"></i>Quick Buy
                            </h6>
                            <form id="quick-buy-form">
                                <div class="mb-3">
                                    <label for="buy_token_address" class="form-label">Token Address</label>
                                    <input type="text" class="form-control" id="buy_token_address" 
                                           placeholder="0x..." pattern="^0x[a-fA-F0-9]{40}$" required>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-8">
                                        <label for="buy_amount" class="form-label">Amount (ETH)</label>
                                        <input type="number" class="form-control" id="buy_amount" 
                                               min="0.001" max="10" step="0.001" value="0.1" required>
                                    </div>
                                    <div class="col-4">
                                        <label for="buy_slippage" class="form-label">Slippage %</label>
                                        <input type="number" class="form-control" id="buy_slippage" 
                                               min="0.1" max="10" step="0.1" value="1.0" required>
                                    </div>
                                </div>
                                <button type="submit" class="fast-execute-btn w-100">
                                    <i class="bi bi-lightning-charge me-1"></i>Fast Buy
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Quick Sell Panel -->
                    <div class="col-md-6">
                        <div class="quick-buy-panel">
                            <h6 class="mb-3">
                                <i class="bi bi-cart-dash me-2"></i>Quick Sell
                            </h6>
                            <form id="quick-sell-form">
                                <div class="mb-3">
                                    <label for="sell_token_address" class="form-label">Token Address</label>
                                    <input type="text" class="form-control" id="sell_token_address" 
                                           placeholder="0x..." pattern="^0x[a-fA-F0-9]{40}$" required>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-8">
                                        <label for="sell_amount" class="form-label">Token Amount</label>
                                        <input type="number" class="form-control" id="sell_amount" 
                                               min="0.000001" step="any" required>
                                    </div>
                                    <div class="col-4">
                                        <label for="sell_slippage" class="form-label">Slippage %</label>
                                        <input type="number" class="form-control" id="sell_slippage" 
                                               min="0.1" max="10" step="0.1" value="1.0" required>
                                    </div>
                                </div>
                                <button type="submit" class="fast-execute-btn w-100">
                                    <i class="bi bi-lightning-charge me-1"></i>Fast Sell
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Trading Session Controls -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Fast Lane Trading Session</h6>
                                <small class="text-muted">Automated trading with current configuration</small>
                            </div>
                            <div>
                                <button class="btn btn-success me-2" id="start-fast-session" 
                                        data-action="start-session">
                                    <i class="bi bi-play-circle me-1"></i>Start Session
                                </button>
                                <button class="btn btn-warning" id="stop-fast-session" 
                                        data-action="stop-session" style="display: none;">
                                    <i class="bi bi-stop-circle me-1"></i>Stop Session
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Status Sidebar -->
        <div class="col-xl-4">
            <!-- Performance Preview -->
            <div class="card fast-lane-container mb-4 sticky-top" style="top: 1rem;">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="bi bi-speedometer2 me-2"></i>Performance Preview
                    </h6>
                </div>
                <div class="card-body text-center">
                    <div class="speed-indicator mb-3">
                        <div class="text-center">
                            <div class="execution-speed-display" id="speed-display">500ms</div>
                            <small class="text-white">Execution Speed</small>
                        </div>
                    </div>
                    
                    <div class="row g-3 mb-3">
                        <div class="col-6">
                            <div class="performance-gauge">
                                <div class="gauge-fill" id="speed-gauge" style="height: 60%"></div>
                                <div class="gauge-needle" id="speed-needle" style="transform: rotate(-60deg)"></div>
                            </div>
                            <small class="text-muted">Speed Index</small>
                        </div>
                        <div class="col-6">
                            <div class="performance-gauge">
                                <div class="gauge-fill" id="risk-gauge" style="height: 40%"></div>
                                <div class="gauge-needle" id="risk-needle" style="transform: rotate(-80deg)"></div>
                            </div>
                            <small class="text-muted">Risk Level</small>
                        </div>
                    </div>
                    
                    <div class="config-preview">
                        <div class="row g-2 text-start">
                            <div class="col-6">
                                <small class="text-muted">Position Size:</small>
                                <div class="fw-bold" id="preview-position-size">0.1 ETH</div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">Max Slippage:</small>
                                <div class="fw-bold" id="preview-slippage">1.0%</div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">Gas Multiplier:</small>
                                <div class="fw-bold" id="preview-gas">1.2x</div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">MEV Protection:</small>
                                <div class="fw-bold text-success" id="preview-mev">Enabled</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Market Data -->
            <div class="card fast-lane-container mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="bi bi-activity me-2"></i>Live Market Data
                    </h6>
                </div>
                <div class="card-body">
                    <!-- Mempool Monitor -->
                    <div class="mempool-monitor mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Mempool Status</span>
                            <span class="badge bg-success">Active</span>
                        </div>
                        <div class="live-trading-status">
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar bg-info" style="width: 75%"></div>
                            </div>
                        </div>
                        <small class="text-muted">Monitoring 2,347 pending transactions</small>
                    </div>
                    
                    <!-- Gas Tracker -->
                    <div class="gas-tracker mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Gas Tracker</span>
                            <span class="text-warning">15.2 Gwei</span>
                        </div>
                        <div class="row g-2 text-center">
                            <div class="col-4">
                                <div class="text-success">12</div>
                                <small class="text-muted">Slow</small>
                            </div>
                            <div class="col-4">
                                <div class="text-warning">15</div>
                                <small class="text-muted">Standard</small>
                            </div>
                            <div class="col-4">
                                <div class="text-danger">18</div>
                                <small class="text-muted">Fast</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Network Status -->
                    <div class="text-center">
                        <div class="row g-2">
                            <div class="col-6">
                                <div class="text-success">12.1s</div>
                                <small class="text-muted">Block Time</small>
                            </div>
                            <div class="col-6">
                                <div class="text-info">98.7%</div>
                                <small class="text-muted">Success Rate</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Fast Lane Activity -->
            <div class="card fast-lane-container">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="bi bi-clock-history me-2"></i>Recent Activity
                    </h6>
                </div>
                <div class="card-body p-0">
                    <div id="fast-lane-activity">
                        <div class="text-center py-4 text-muted">
                            <i class="bi bi-hourglass-split display-4 d-block mb-3"></i>
                            <p>No recent activity</p>
                            <small>Fast Lane trades will appear here</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/trading.js' %}"></script>
<script src="{% static 'dashboard/js/fast_lane_config.js' %}"></script>
{% endblock %}