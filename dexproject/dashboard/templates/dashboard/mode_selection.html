{% extends 'base.html' %}
{% load static %}

{% block title %}Mode Selection - {{ block.super }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dashboard/css/mode_selection.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 mb-1">
                        <i class="bi bi-shuffle me-2"></i>Select Trading Mode
                    </h1>
                    <p class="text-muted mb-0">
                        Choose between speed-optimized Fast Lane or intelligence-optimized Smart Lane
                    </p>
                </div>
                <div>
                    {% if is_mock_mode %}
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-info-circle me-1"></i>Demo Mode
                        </span>
                    {% else %}
                        <span class="badge bg-success">
                            <i class="bi bi-check-circle me-1"></i>Live Data
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Trading Mode Cards -->
    <div class="row g-4 mb-5">
        <!-- Fast Lane Mode -->
        <div class="col-lg-6">
            <div class="card card-glass mode-card fast-lane-card h-100 position-relative" 
                 {% if fast_lane_available %}data-mode="FAST_LANE"{% else %}aria-disabled="true"{% endif %}>
                
                {% if not fast_lane_available %}
                <div class="disabled-overlay">
                    <div class="text-center text-white">
                        <i class="bi bi-tools display-4 mb-2"></i>
                        <div class="h5">Under Maintenance</div>
                        <small>Fast Lane temporarily unavailable</small>
                    </div>
                </div>
                {% endif %}
                
                <div class="card-header text-center">
                    <i class="bi bi-lightning-charge fast-lane-accent fs-1 mb-2"></i>
                    <h3 class="fast-lane-accent mb-1">âš¡ Fast Lane</h3>
                    <p class="text-muted mb-0">Speed-Optimized Execution</p>
                </div>
                <div class="card-body">
                    <!-- Performance Metrics -->
                    <div class="row mb-3">
                        <div class="col-4">
                            <div class="performance-metric">
                                <div class="metric-value fast-lane-accent">
                                    {{ fast_lane_metrics.execution_time_ms }}ms
                                </div>
                                <div class="metric-label">Execution</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="performance-metric">
                                <div class="metric-value text-success">
                                    {{ fast_lane_metrics.success_rate }}%
                                </div>
                                <div class="metric-label">Success</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="performance-metric">
                                <div class="metric-value text-info">
                                    {{ fast_lane_metrics.trades_per_minute }}
                                </div>
                                <div class="metric-label">Trades/Min</div>
                            </div>
                        </div>
                    </div>

                    <!-- Features -->
                    <h6 class="text-uppercase text-muted mb-2">Key Features</h6>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-lightning fast-lane-accent me-2"></i>Sub-500ms execution</li>
                        <li><i class="bi bi-shield-check fast-lane-accent me-2"></i>MEV protection</li>
                        <li><i class="bi bi-graph-up fast-lane-accent me-2"></i>Mempool monitoring</li>
                        <li><i class="bi bi-speedometer2 fast-lane-accent me-2"></i>Gas optimization</li>
                    </ul>

                    <!-- Status Badge -->
                    <div class="mt-3">
                        {% if fast_lane_available %}
                            <span class="badge bg-success">
                                <i class="bi bi-check-circle me-1"></i>{{ fast_lane_metrics.status }}
                            </span>
                        {% else %}
                            <span class="badge bg-secondary">
                                <i class="bi bi-wrench me-1"></i>{{ fast_lane_metrics.status }}
                            </span>
                        {% endif %}
                        <span class="badge bg-primary ms-2 phase-badge">{{ fast_lane_metrics.phase }}</span>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <button class="btn btn-success btn-lg w-100" 
                            {% if not fast_lane_available %}disabled{% endif %}
                            data-mode="FAST_LANE"
                            aria-label="Choose Fast Lane trading mode">
                        <i class="bi bi-lightning-charge me-2"></i>Choose Fast Lane
                    </button>
                </div>
            </div>
        </div>

        <!-- Smart Lane Mode -->
        <div class="col-lg-6">
            <div class="card card-glass mode-card smart-lane-card h-100 position-relative" 
                 {% if smart_lane_available %}data-mode="SMART_LANE"{% else %}aria-disabled="true"{% endif %}>
                
                {% if not smart_lane_available %}
                <div class="disabled-overlay">
                    <div class="text-center text-white">
                        <i class="bi bi-gear display-4 mb-2"></i>
                        <div class="h5">Development Mode</div>
                        <small>Smart Lane available for testing</small>
                    </div>
                </div>
                {% endif %}
                
                <div class="card-header text-center">
                    <i class="bi bi-cpu smart-lane-accent fs-1 mb-2"></i>
                    <h3 class="smart-lane-accent mb-1">ðŸ§  Smart Lane</h3>
                    <p class="text-muted mb-0">Intelligence-Optimized Analysis</p>
                </div>
                <div class="card-body">
                    <!-- Performance Metrics -->
                    <div class="row mb-3">
                        <div class="col-4">
                            <div class="performance-metric">
                                <div class="metric-value smart-lane-accent">
                                    {{ smart_lane_metrics.execution_time_ms }}ms
                                </div>
                                <div class="metric-label">Analysis Time</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="performance-metric">
                                <div class="metric-value text-success">
                                    {{ smart_lane_metrics.success_rate }}%
                                </div>
                                <div class="metric-label">Success Rate</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="performance-metric">
                                <div class="metric-value text-warning">
                                    +{{ smart_lane_metrics.risk_adjusted_return }}%
                                </div>
                                <div class="metric-label">Risk-Adj Return</div>
                            </div>
                        </div>
                    </div>

                    <!-- Features -->
                    <h6 class="text-uppercase text-muted mb-2">Key Features</h6>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-brain smart-lane-accent me-2"></i>Comprehensive analysis</li>
                        <li><i class="bi bi-shield-check smart-lane-accent me-2"></i>AI-powered risk assessment</li>
                        <li><i class="bi bi-pie-chart smart-lane-accent me-2"></i>Strategic position sizing</li>
                        <li><i class="bi bi-lightbulb smart-lane-accent me-2"></i>AI thought logs</li>
                    </ul>

                    <!-- Status Badge -->
                    <div class="mt-3">
                        {% if smart_lane_available %}
                            <span class="badge bg-info">
                                <i class="bi bi-gear me-1"></i>{{ smart_lane_metrics.status }}
                            </span>
                        {% else %}
                            <span class="badge bg-warning text-dark">
                                <i class="bi bi-clock me-1"></i>{{ smart_lane_metrics.status }}
                            </span>
                        {% endif %}
                        <span class="badge bg-secondary ms-2 phase-badge">{{ smart_lane_metrics.phase }}</span>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <!-- Always enable Smart Lane button for Phase 5 testing -->
                    <button class="btn btn-primary btn-lg w-100"
                            data-mode="SMART_LANE"
                            aria-label="Choose Smart Lane trading mode">
                        <i class="bi bi-cpu me-2"></i>Choose Smart Lane
                    </button>
                    {% if not smart_lane_available %}
                    <small class="text-muted d-block mt-2">
                        <i class="bi bi-info-circle me-1"></i>Demo mode available
                    </small>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison and Information -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card card-glass">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-info-circle me-2"></i>Mode Comparison
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="fast-lane-accent">Fast Lane - For Speed</h6>
                            <ul class="list-unstyled small">
                                <li>â€¢ Sub-500ms execution times</li>
                                <li>â€¢ Perfect for sniping new launches</li>
                                <li>â€¢ MEV protection and private mempools</li>
                                <li>â€¢ Real-time mempool monitoring</li>
                                <li>â€¢ Gas optimization for minimum fees</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="smart-lane-accent">Smart Lane - For Intelligence</h6>
                            <ul class="list-unstyled small">
                                <li>â€¢ Comprehensive risk analysis</li>
                                <li>â€¢ AI-powered decision making</li>
                                <li>â€¢ Strategic position sizing</li>
                                <li>â€¢ Technical and social analysis</li>
                                <li>â€¢ Full transparency with thought logs</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <p class="text-muted mb-3">
                            <strong class="comparison-highlight">Hybrid Approach:</strong> 
                            Switch between modes based on market conditions and opportunities
                        </p>
                        
                        <div class="d-flex gap-3 justify-content-center">
                            <button class="btn btn-outline-info btn-sm" 
                                    data-action="demo"
                                    aria-label="View Smart Lane demonstration">
                                <i class="bi bi-play me-1"></i>View Smart Lane Demo
                            </button>
                            <button class="btn btn-outline-light btn-sm" 
                                    data-action="hybrid-info"
                                    aria-label="Learn about hybrid trading strategy">
                                <i class="bi bi-shuffle me-1"></i>Learn Hybrid Strategy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mt-4 mb-5">
        <div class="col-12 text-center">
            <a href="{% url 'dashboard:home' %}" class="btn btn-outline-light btn-lg me-3">
                <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
            </a>
        </div>
    </div>
</div>

<!-- Hybrid Strategy Modal -->
<div class="modal fade" id="hybridModal" tabindex="-1" aria-labelledby="hybridModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title" id="hybridModalLabel">
                    <i class="bi bi-shuffle me-2"></i>Hybrid Trading Strategy
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="fast-lane-accent">Use Fast Lane For:</h6>
                        <ul>
                            <li>New token launches and sniping</li>
                            <li>Arbitrage opportunities</li>
                            <li>Quick scalping trades</li>
                            <li>Time-sensitive market movements</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="smart-lane-accent">Use Smart Lane For:</h6>
                        <ul>
                            <li>Strategic portfolio positions</li>
                            <li>Risk-adjusted trading decisions</li>
                            <li>Complex market analysis</li>
                            <li>Long-term investment planning</li>
                        </ul>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3">
                    <h6><i class="bi bi-lightbulb me-2"></i>Pro Tip</h6>
                    <p class="mb-0">Start with the mode that matches your immediate trading goal, then switch as market conditions change. Both engines can run simultaneously for maximum flexibility.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" data-modal-action="FAST_LANE">
                    <i class="bi bi-lightning me-1"></i>Start with Fast Lane
                </button>
                <button type="button" class="btn btn-primary" data-modal-action="SMART_LANE">
                    <i class="bi bi-cpu me-1"></i>Start with Smart Lane
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'dashboard/js/mode_selection.js' %}"></script>
{% endblock %}